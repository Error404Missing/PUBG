generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String    @id @default(uuid())
  username     String    @unique
  email        String    @unique
  password     String
  role         String    @default("GUEST")
  lastCaseOpen DateTime?
  vipUntil     DateTime?
  createdAt    DateTime  @default(now())
  team         Team?
}

model Team {
  id          String   @id @default(uuid())
  name        String
  tag         String
  leaderId    String   @unique
  leader      User     @relation(fields: [leaderId], references: [id])
  status      String   @default("PENDING")
  isVip       Boolean  @default(false)
  playerCount Int      @default(4)
  mapsCount   Int      @default(0)
  blockReason String?
  updatedAt   DateTime @updatedAt
  createdAt   DateTime @default(now())
  slots       Slot[]
}

model Scrim {
  id        String   @id @default(uuid())
  startTime DateTime
  map       String
  maxTeams  Int
  status    String   @default("OPEN")
  roomId    String?
  roomPass  String?
  slots     Slot[]
  results   Result[]
}

model Slot {
  id         String @id @default(uuid())
  slotNumber Int
  teamId     String
  team       Team   @relation(fields: [teamId], references: [id])
  scrimId    String
  scrim      Scrim  @relation(fields: [scrimId], references: [id])

  @@unique([scrimId, slotNumber])
  @@unique([scrimId, teamId])
}

model Result {
  id          String  @id @default(uuid())
  image       String
  description String?
  scrimId     String
  scrim       Scrim   @relation(fields: [scrimId], references: [id])
}

model SystemConfig {
  key   String @id
  value String
}

model AuditLog {
  id        String   @id @default(uuid())
  action    String
  userId    String
  username  String
  details   String?
  createdAt DateTime @default(now())
}

model CaseReward {
  id        String   @id @default(uuid())
  userId    String
  username  String
  type      String   // VIP_3, VIP_7, VIP_30
  status    String   @default("PENDING") // PENDING, APPROVED, REJECTED
  createdAt DateTime @default(now())
}
